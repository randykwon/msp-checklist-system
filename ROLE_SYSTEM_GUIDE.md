# MSP 헬퍼 관리자 시스템 - 역할 기반 권한 시스템 가이드

## 🎯 개요

MSP 헬퍼 관리자 시스템에 4단계 역할 기반 권한 시스템을 구현했습니다. 각 역할별로 접근 가능한 기능이 다르게 설정되어 있습니다.

## 👥 역할 체계

### 1. 일반 사용자 (user)
- **권한**: 관리자 시스템 접근 불가
- **용도**: MSP 평가를 진행하는 일반 사용자
- **접근**: 메인 시스템(포트 3010)만 사용 가능

### 2. 운영자 (operator) 🆕
- **권한**: 제한적 관리자 기능
- **접근 가능한 메뉴**:
  - ✅ 대시보드
  - ✅ 진행 현황 모니터링
  - ✅ 공지사항 관리
  - ✅ 시스템 모니터링
- **접근 불가능한 메뉴**:
  - ❌ 사용자 관리
  - ❌ 질의응답 관리
  - ❌ 조언 캐시 관리
  - ❌ 시스템 관리

### 3. 관리자 (admin)
- **권한**: 모든 관리자 기능 접근 가능
- **접근 가능한 메뉴**: 모든 메뉴
- **용도**: 일반적인 시스템 관리자

### 4. 슈퍼관리자 (superadmin) 🆕
- **권한**: 모든 관리자 기능 + 최고 권한
- **접근 가능한 메뉴**: 모든 메뉴
- **용도**: 시스템 최고 관리자
- **특징**: 기존 admin 계정들이 자동으로 업그레이드됨

## 🔐 계정 정보

### 기본 제공 계정

#### 슈퍼관리자 계정
```
📧 이메일: admin@msp.com
🔑 비밀번호: admin123!
👤 역할: superadmin
```

#### 운영자 계정
```
📧 이메일: operator@msp.com
🔑 비밀번호: operator123!
👤 역할: operator
```

## 🛠️ 관리 스크립트

### 1. 운영자 계정 생성
```bash
node create-operator.cjs
```

### 2. 기존 관리자를 슈퍼관리자로 업그레이드
```bash
node upgrade-to-superadmin.cjs
```

## 📋 권한 매트릭스

| 기능 | 일반사용자 | 운영자 | 관리자 | 슈퍼관리자 |
|------|------------|--------|--------|------------|
| 메인 시스템 접근 | ✅ | ✅ | ✅ | ✅ |
| 관리자 시스템 접근 | ❌ | ✅ | ✅ | ✅ |
| 대시보드 | ❌ | ✅ | ✅ | ✅ |
| 진행 현황 모니터링 | ❌ | ✅ | ✅ | ✅ |
| 사용자 관리 | ❌ | ❌ | ✅ | ✅ |
| 공지사항 관리 | ❌ | ✅ | ✅ | ✅ |
| 질의응답 관리 | ❌ | ❌ | ✅ | ✅ |
| 조언 캐시 관리 | ❌ | ❌ | ✅ | ✅ |
| 시스템 관리 | ❌ | ❌ | ✅ | ✅ |
| 시스템 모니터링 | ❌ | ✅ | ✅ | ✅ |

## 🎨 UI 개선사항

### 1. 역할별 색상 구분
- **일반 사용자**: 회색 (Gray)
- **운영자**: 파란색 (Blue)
- **관리자**: 초록색 (Green)
- **슈퍼관리자**: 보라색 (Purple)

### 2. 사용자 카드 개선
- 역할별 아바타 색상 구분
- 역할 배지 표시
- 권한에 따른 메뉴 필터링

### 3. 권한 기반 네비게이션
- 사용자 역할에 따라 메뉴 자동 필터링
- 접근 불가능한 페이지 자동 리다이렉트
- 사용자 정보에 역할 표시

## 🔧 기술적 구현

### 1. 권한 시스템 (`lib/permissions.ts`)
```typescript
export type UserRole = 'user' | 'operator' | 'admin' | 'superadmin';

export const ROLE_PERMISSIONS: Record<UserRole, Permission> = {
  // 역할별 권한 정의
};
```

### 2. 권한 가드 컴포넌트 (`components/PermissionGuard.tsx`)
```typescript
<PermissionGuard requiredRoute="/users">
  {/* 보호된 컴포넌트 */}
</PermissionGuard>
```

### 3. 데이터베이스 스키마 업데이트
```sql
-- 역할 체크 제약 조건 업데이트
role TEXT DEFAULT 'user' CHECK(role IN ('user', 'operator', 'admin', 'superadmin'))
```

## 🚀 사용 방법

### 1. 관리자 시스템 접속
```
URL: http://localhost:3011
```

### 2. 역할별 로그인 테스트
1. **슈퍼관리자**: `admin@msp.com` / `admin123!`
2. **운영자**: `operator@msp.com` / `operator123!`

### 3. 권한 확인
- 로그인 후 좌측 메뉴에서 역할에 따른 메뉴 표시 확인
- 사용자 정보에서 역할 배지 확인
- 접근 불가능한 페이지 접근 시 자동 리다이렉트 확인

## 🔄 역할 변경

### 사용자 관리 페이지에서 역할 변경
1. 관리자 시스템 → 사용자 관리
2. 대상 사용자 선택
3. "역할 변경" 버튼 클릭
4. 원하는 역할 선택

### 지원되는 역할 변경
- 일반 사용자 ↔ 운영자 ↔ 관리자 ↔ 슈퍼관리자

## 📊 모니터링

### 1. 사용자 활동 모니터링
- 역할별 사용자 수 통계
- 권한별 접근 로그
- 역할 변경 이력

### 2. 보안 모니터링
- 무권한 접근 시도 로그
- 역할 변경 알림
- 시스템 접근 패턴 분석

## 🛡️ 보안 고려사항

### 1. 권한 상승 방지
- 각 역할은 자신보다 높은 권한으로 변경 불가
- 슈퍼관리자만 모든 역할 변경 가능

### 2. 세션 관리
- 역할 변경 시 기존 세션 무효화
- JWT 토큰에 역할 정보 포함
- 권한 체크는 서버 사이드에서 수행

### 3. 감사 로그
- 모든 권한 관련 작업 로그 기록
- 역할 변경 이력 추적
- 시스템 접근 기록 보관

이 권한 시스템을 통해 MSP 헬퍼 관리자 시스템의 보안성과 관리 효율성이 크게 향상되었습니다.